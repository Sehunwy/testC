(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-18194d70"],{"07f2":function(e,t,a){"use strict";var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form",{attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"选择产品"}},[a("el-select",{attrs:{loading:e.isLoading,"value-key":"Id",clearable:"",placeholder:"选择物料",filterable:"",remote:"","remote-method":e.getKeys},on:{change:e.change},model:{value:e.id,callback:function(t){e.id=t},expression:"id"}},e._l(e.materialList,function(t,l){return a("el-option",{key:l,attrs:{value:t.Id,label:t.Name}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.Id))]),a("span",{staticStyle:{float:"left",margin:"0 20px"}},[e._v(e._s(t.Ctrl))]),a("span",{staticStyle:{float:"right"}},[e._v(e._s(t.Name))])])}))],1)],1)},i=[],n=a("c665"),s=a("dc0a"),r=a("aa9a"),o=a("d328"),c=a("11d9"),u=a("9ab4"),d=a("2b0e"),m=a("60a3"),b=function(e){function t(){var e;return Object(n["a"])(this,t),e=Object(o["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.isLoading=!1,e.id="",e.materialList=[],e.req={moduleName:"mes.business.pub.service",className:"MaterialService",method:"getKeys",args:{key:""}},e}return Object(r["a"])(t,[{key:"getKeys",value:function(e){var t=this;this.isLoading=!0,this.req.args.key=e,this.$Api.invoke(this.req).then(function(e){t.materialList=e.data.data}).finally(function(){t.isLoading=!1})}},{key:"change",value:function(e){}},{key:"mounted",value:function(){this.getKeys("")}}]),Object(s["a"])(t,e),t}(d["default"]);u["a"]([Object(m["b"])(),u["b"]("design:type",Function),u["b"]("design:paramtypes",[Object]),u["b"]("design:returntype",void 0)],b.prototype,"change",null),b=u["a"]([m["a"]],b);var p=b,h=p,f=h,y=(a("3266"),a("2877")),g=Object(y["a"])(f,l,i,!1,null,"3d49bd7f",null);g.options.__file="materialSelect.vue";t["a"]=g.exports},3266:function(e,t,a){"use strict";var l=a("3578"),i=a.n(l);i.a},3578:function(e,t,a){},"6c7c":function(e,t,a){},8076:function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("material-select",{on:{change:e.query}}),a("hr"),e.data?a("el-form",{attrs:{"label-position":"right","label-width":"80px",inline:!0}},[a("el-row",[a("el-col",{attrs:{span:8}},[a("h1",[e._v(e._s(e.data.MaterialName))])]),a("el-col",{attrs:{span:8}},[a("el-form",{attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"版本号"}},[a("el-input",{attrs:{placeholder:"",readonly:!0},model:{value:e.data.Id,callback:function(t){e.$set(e.data,"Id",t)},expression:"data.Id"}})],1),a("el-form-item",{attrs:{label:"审批时间"}},[a("el-input",{attrs:{placeholder:"",readonly:!0},model:{value:e.data.CommitTime,callback:function(t){e.$set(e.data,"CommitTime",t)},expression:"data.CommitTime"}})],1)],1)],1)],1)],1):e._e(),a("hr"),a("el-tabs",{directives:[{name:"loading",rawName:"v-loading",value:e.isBusy,expression:"isBusy"}],attrs:{type:"card",value:e.selectedTabName},model:{value:e.selectedTabName,callback:function(t){e.selectedTabName=t},expression:"selectedTabName"}},[a("el-tab-pane",{key:"1",attrs:{label:"配方数据",name:"bom"}},[a("el-table",{attrs:{data:e.bomDetails,"default-sort":{prop:"IsPurchase"},"show-summary":"","summary-method":e.getSummaries}},[a("el-table-column",{attrs:{label:"#",type:"index",width:"120"}}),a("el-table-column",{attrs:{label:"物料编码",prop:"MaterialCd",width:"300"}}),a("el-table-column",{attrs:{label:"物料名称",prop:"MaterialName",sortable:""}}),a("el-table-column",{attrs:{label:"单位",prop:"Measure"}}),a("el-table-column",{attrs:{label:"分子",prop:"Numerator"}}),a("el-table-column",{attrs:{label:"分母",prop:"Denominator"}}),a("el-table-column",{attrs:{label:"比例",prop:"Ratio"}}),a("el-table-column",{attrs:{label:"属性",prop:"IsPurchase",sortable:""}}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"show",rawName:"v-show",value:"自制件"===t.row.IsPurchase,expression:"scope.row.IsPurchase==='自制件'"}],attrs:{type:" primary",icon:"el-icon-d-arrow-right"},on:{click:function(a){e.navigate(t.row.MaterialCd)}}})]}}])})],1)],1),a("el-tab-pane",{key:"2",attrs:{label:"配方展开",name:"expandBoms"}},[a("el-table",{attrs:{data:e.expandedBoms,"max-height":"800"}},[a("el-table-column",{attrs:{label:"层级",prop:"Level",width:"60"}}),a("el-table-column",{attrs:{label:"#",type:"index",width:"60"}}),a("el-table-column",{attrs:{label:"父物料编码",prop:"PCd",width:"120"}}),a("el-table-column",{attrs:{label:"父物料名称",prop:"PName",width:"300"}}),a("el-table-column",{attrs:{label:"父物料单位",prop:"PMeasure",width:"120",align:"center"}}),a("el-table-column",{attrs:{label:"子物料编码",prop:"CCd",width:"120"}}),a("el-table-column",{attrs:{label:"子物料名称",prop:"CName",width:"300"}}),a("el-table-column",{attrs:{label:"子物料单位",prop:"CMeasure",width:"120",align:"center"}}),a("el-table-column",{attrs:{label:"分子",prop:"Numerator",align:"right",width:"120"}}),a("el-table-column",{attrs:{label:"分母",prop:"Denominator",align:"right",width:"120"}}),a("el-table-column",{attrs:{label:"比例",prop:"Ratio",alias:"right",width:"180",align:"right"}}),a("el-table-column",{attrs:{label:"属性",prop:"IsPurchase",align:"center",width:"150",sortable:""}})],1)],1)],1)],1)},i=[],n=(a("ac6a"),a("7f7f"),a("c665")),s=a("dc0a"),r=a("aa9a"),o=a("d328"),c=a("11d9"),u=a("9ab4"),d=a("2b0e"),m=a("60a3"),b=a("0063"),p=a.n(b),h=a("07f2"),f=function(e){function t(){var e;return Object(n["a"])(this,t),e=Object(o["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.cd="",e.isBusy=!1,e.data={},e.expandedBoms=[],e.selectedTabName="bom",e.sumProp=["Numerator","Ratio"],e}return Object(r["a"])(t,[{key:"query",value:function(e){this.cd=e,console.log(this.isBusy),this.getBom()}},{key:"getBom",value:function(){var e=this;null!==this.cd&&(this.isBusy=!0,this.$Api.invoke({moduleName:"mes.business.pub.service",className:"BomService",method:"getBom",args:{cd:this.cd}}).then(function(t){e.data=t.data.data,e.data&&(e.data.CommitTime=new Date(Date.parse(e.data.CommitTime)).toLocaleString()),e.getExpandedBoms(),e.isBusy=!1}).catch(function(e){console.log(e)}).finally(function(){e.isBusy=!1,console.log("finallyTest")}))}},{key:"getExpandedBoms",value:function(){var e=this;this.cd&&(this.isBusy=!0,this.$Api.invoke({moduleName:"mes.business.pub.service",className:"BomService",method:"getExpandBom",args:{cd:this.cd}}).then(function(t){e.expandedBoms=t.data.data,e.isBusy=!1}).catch(function(t){e.isBusy=!1}))}},{key:"onNavigation",value:function(e,t){if("bom"===e.name)try{this.cd=e.query.id,this.cd&&this.query(this.cd)}catch(e){console.log(e)}}},{key:"created",value:function(){this.onNavigation(this.$route,null)}},{key:"mounted",value:function(){}},{key:"navigate",value:function(e){this.$router.push({path:"/pub/bom",query:{id:e}})}},{key:"getSummaries",value:function(e){var t=this,a=e.columns,l=e.data,i=[];return a.forEach(function(e,a){if(0!==a){var n=p.a.from(l);if(t.sumProp.indexOf(e.property)>=0){var s=n.sum(function(t){return t[e.property]});i[a]=s.toFixed(4)}else if("Denominator"===e.property){var r=n.firstOrDefault();r&&(i[a]=r.Denominator)}}else i[a]="合计"}),i}},{key:"bomDetails",get:function(){return this.data?this.data.Details:[]}}]),Object(s["a"])(t,e),t}(d["default"]);u["a"]([Object(m["f"])("$route"),u["b"]("design:type",Function),u["b"]("design:paramtypes",[Object,Object]),u["b"]("design:returntype",void 0)],f.prototype,"onNavigation",null),f=u["a"]([Object(m["a"])({components:{MaterialSelect:h["a"]}})],f);var y=f,g=y,v=g,L=(a("f305"),a("2877")),k=Object(L["a"])(v,l,i,!1,null,"8b4b98b8",null);k.options.__file="bom.vue";t["default"]=k.exports},ac6a:function(e,t,a){for(var l=a("cadf"),i=a("0d58"),n=a("2aba"),s=a("7726"),r=a("32e9"),o=a("84f2"),c=a("2b4c"),u=c("iterator"),d=c("toStringTag"),m=o.Array,b={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=i(b),h=0;h<p.length;h++){var f,y=p[h],g=b[y],v=s[y],L=v&&v.prototype;if(L&&(L[u]||r(L,u,m),L[d]||r(L,d,y),o[y]=m,g))for(f in l)L[f]||n(L,f,l[f],!0)}},f305:function(e,t,a){"use strict";var l=a("6c7c"),i=a.n(l);i.a}}]);