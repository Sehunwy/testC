(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-dcd36cf8"],{"215a":function(t,e,n){},"34f2":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("location",{attrs:{title:"拜访定位",rightText:"开始拜访"},on:{goBack:t.goBack,locationCompleted:t.locationCompleted,selectionChanged:t.selectionChanged}})],1)},a=[],o=(n("a481"),n("c665")),r=n("dc0a"),c=n("aa9a"),s=n("d328"),u=n("11d9"),d=n("9ab4"),h=n("2b0e"),l=n("60a3"),f=n("2b67"),g=n("5dc0"),m=n("46c4"),C=function(t){function e(){var t;return Object(o["a"])(this,e),t=Object(s["a"])(this,Object(u["a"])(e).apply(this,arguments)),t.currentPersonId="",t.currentEntId="",t.currentEntCd="",t.currentCustomerId="",t.currentCustomerName="",t.currentLocation={},t.currentLocationPoint={},t.currentLocationDesc="",t.isBusy=!1,t}return Object(c["a"])(e,[{key:"created",value:function(){this.currentCustomerId=this.$route.query.customerId,this.currentCustomerName=this.$route.query.customerName,this.currentEntId=f["a"].instance.getEntId(),this.currentEntCd=f["a"].instance.getEntCd(),this.currentPersonId=f["a"].instance.getPersonId()}},{key:"locationCompleted",value:function(t){this.currentLocation=t,this.currentLocationPoint=t.point,this.currentLocationDesc=t.address,this.beginVisit()}},{key:"beginVisit",value:function(){var t=this;this.checkBeginVisitInfo()&&(this.isBusy=!0,this.$Api.invoke({moduleName:"crm.visit.visitService",className:"VisitService",method:"beginVisit",args:{personId:this.currentPersonId,beginData:{EntId:this.currentEntId,EntCd:this.currentEntCd,CustomerId:this.currentCustomerId,CustomerName:this.currentCustomerName,BeginLongitude:this.currentLocationPoint.lng,BeginLatitude:this.currentLocationPoint.lat,BeginLocationDesc:this.currentLocationDesc}}}).then(function(e){e.data&&e.data.isSuccess?(t.notifyStartCurrentVisit(e.data.data),t.goCreateVisit(e.data.data)):m["a"].toastMessage("开始拜访失败!"+e.data.error),console.log(e)}).catch(function(t){m["a"].toastMessage("开始拜访异常!"+t),console.log(t)}).finally(function(){t.isBusy=!1}))}},{key:"notifyStartCurrentVisit",value:function(t){this.$store.commit("setCurrentVisitId",t)}},{key:"checkBeginVisitInfo",value:function(){return this.currentCustomerId?this.currentLocation&&this.currentLocationPoint?!!this.currentPersonId||(m["a"].toastMessage("未能确定您的登录信息,请退出重新登录!"),!1):(m["a"].toastMessage("没有获取到定位信息,请尝试重新定位!"),!1):(m["a"].toastMessage("没有指定拜访客户,请返回重试!"),!1)}},{key:"goCreateVisit",value:function(t){this.$router.replace({path:"/createVisit",query:{newVisitId:t}})}},{key:"selectionChanged",value:function(t){}},{key:"goBack",value:function(){var t=this;m["a"].dialogConfirm("温馨提示","请确认要取消拜访?").then(function(){t.$router.back()}).catch(function(){})}}]),Object(r["a"])(e,t),e}(h["default"]);C=d["a"]([Object(l["a"])({components:{location:g["a"]}})],C);var v=C,I=v,k=I,p=(n("f1a3"),n("2877")),y=Object(p["a"])(k,i,a,!1,null,"7d52d7f5",null);y.options.__file="visitLocation.vue";e["default"]=y.exports},f1a3:function(t,e,n){"use strict";var i=n("215a"),a=n.n(i);a.a}}]);